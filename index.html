<!DOCTYPE html>
<html lang="uk">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <title>–ù–∞—à –≤–ª–∞—Å–Ω–∏–π —á–∞—Ç</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.0/socket.io.js"></script>  
</head>
<body>
  <div class="chat-container">
  <h1>–ù–∞—à –∑ —Ç–æ–±–æ—é —á–∞—Ç –∫–≤—ñ—Ç–∫–æ</h1>
  <div id="chat" class="chat-box"></div>  
  <textarea class="chat-input" id="msgInput" placeholder="–ù–∞–ø–∏—à–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..." rows="4"></textarea>
  <button class="chat-button" onclick="sendMessage()">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
  <div id="users-online">üü¢ –û–Ω–ª–∞–π–Ω: </div>
  <div id="typing-indicator" class="users-online"></div>
  </div>

  <script>
    const chat = document.getElementById('chat');
    const msgInput = document.getElementById('msgInput');
    const msg = msgInput.value.trim();

    // –ü—Ä–∞–≤–∏–ª—å–Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Å–µ—Ä–≤–µ—Ä—É Render
    const socket = io("https://cloud-baby.onrender.com", {
    transports: ["websocket"]
});

socket.on("message", (data) => {
    const div = document.createElement("div");
    div.classList.add("message"); // ‚úÖ –î–æ–¥–∞—î–º–æ –∫–ª–∞—Å
    div.textContent = `${data.user}: ${data.text}`;
    chat.appendChild(div);
    scrollToBottom(); // ‚úÖ –ù–µ –∑–∞–±—É–¥—å –ø—Ä–æ–∫—Ä—É—Ç–∫—É –≤–Ω–∏–∑
});

socket.emit("get_history");

socket.on("chat_history", (messages) => {
  messages.forEach((data) => {
    const div = document.createElement("div");
    div.textContent = `${data.user}: ${data.text}`;
    chat.appendChild(div);
  });
});


let typingTimeout;

msgInput.addEventListener("input", () => {
  socket.emit("typing", true);

  clearTimeout(typingTimeout);
  typingTimeout = setTimeout(() => {
    socket.emit("typing", false);
  }, 2000); // –ß–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥–∏ –±–µ–∑ –≤–≤–µ–¥–µ–Ω–Ω—è ‚Äî –ø—Ä–∏–±–∏—Ä–∞—î–º–æ —Å—Ç–∞—Ç—É—Å
});
socket.on("typing", (data) => {
  const typingDiv = document.getElementById("typing-indicator");

  if (data.typing) {
    typingDiv.textContent = `${data.user} —à–æ—Å—å —Ç–∞–º —Ü—ñ–∫–∞–≤–µ–Ω—å–∫–µ –ø–∏—à–µ...`;
  } else {
    typingDiv.textContent = "";
  }
});




msgInput.addEventListener("keydown", (e) => {
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
});

function sendMessage() {
    const msg = msgInput.value;
    if (msg) {
        socket.emit("message", msg);
        msgInput.value = "";
    }
}
const usersOnlineDiv = document.getElementById('users-online');

// –û—Ç—Ä–∏–º—É—î–º–æ —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
socket.on("users_online", (users) => {
    usersOnlineDiv.innerHTML = "üü¢ –û–Ω–ª–∞–π–Ω: " + users.join(", ");
});

function scrollToBottom() {
  const chatBox = document.getElementById("chat");
  chatBox.scrollTop = chatBox.scrollHeight;
}

// –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø—ñ—Å–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
scrollToBottom();


  </script>
</body>
</html>
