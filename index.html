<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Paradise</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.0/socket.io.js"></script>
</head>
<body>

  <!-- –ï–∫—Ä–∞–Ω –≤—Ö–æ–¥—É -->
  <div class="login-screen" id="loginScreen">
    <h2>–í—Ö—ñ–¥ —É –ø–∞—Ä–∞–¥–∞–π–∑</h2>
    <input type="password" id="passwordInput" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å" />
    <div id="nicknameSelection" style="display: none;">
      <p>–í–∏–±–µ—Ä–∏ —Å–≤—ñ–π –Ω—ñ–∫–Ω–µ–π–º –º–∞–Ω—é–Ω—è –º–æ—è:</p>
      <button onclick="chooseNickname('Baby üòé')">Baby üòé</button>
      <button onclick="chooseNickname('Pink Cloud ‚òÅÔ∏è')">Pink Cloud ‚òÅÔ∏è</button>
    </div>
    <button id="loginButton" onclick="checkPassword()">–£–≤—ñ–π—Ç–∏</button>
    <p id="loginError" style="color:red;"></p>
  </div>

  <!-- –ß–∞—Ç -->
  <div class="chat-container" id="chatContainer" style="display: none;">
    <h1>üå∏ ‚ù§ Rakhiv Paradise ‚ù§ üå∏</h1>
    <div id="chat" class="chat-box"></div>
    <div class="media-controls-area">
      <div class="items">
          <button class="item-btn" onclick="playMusic('audio/Autumn-love.m4a', this)">üçÇ–û—Å—ñ–Ω—åüçÇ</button>
          <button class="item-btn" onclick="playMusic('audio/song2.mp3', this)">üé∂—Ç—É—Ç—É –±—É–¥–µ —â–µ</button>
          <button class="item-btn" onclick="playMusic('audio/song3.mp3', this)">üéº—ñ —Ç—É—Ç</button>
          <button class="item-btn" onclick="playMusic('audio/song4.mp3', this)">üé∏—ñ —Ç—É—Ç</button>
          <button class="item-btn" onclick="playMusic('audio/song5.mp3', this)">üéπ—ñ —Ç—É—Ç</button>
          <button class="item-btn" onclick="playMusic('audio/song6.mp3', this)">üé§—ñ —Ç—É—Ç</button>
          <button class="item-btn" onclick="playMusic('audio/song7.mp3', this)">üéß—ñ —Ç—É—Ç</button>
          <button class="item-btn" onclick="playMusic('audio/song8.mp3', this)">üé∑—ñ —Ç—É—Ç</button>
          <button class="item-btn" onclick="playMusic('audio/song9.mp3', this)">üé∫—ñ —Ç—É—Ç</button>
      </div>
      <div class="volume-control">
        <button id="volumeToggleButton" class="item-btn">üîä</button>
        <input type="range" id="volumeSlider" class="volume-slider" min="0" max="1" step="0.01" style="display: none;">
      </div>
    </div>
    <textarea class="chat-input" id="msgInput" placeholder="–ù–∞–ø–∏—à–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..." rows="4"></textarea>
    <button class="chat-button">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
    <div id="users-online">üü¢ –û–Ω–ª–∞–π–Ω: </div>
    <div id="typing-indicator" class="users-online"></div>
  </div>

  <script>
    let selectedNickname = null;
    let socket = null;
    // –û–≥–æ–ª–æ—à—É—î–º–æ –ø–ª–µ—î—Ä —Ç–∞ –ø–æ–≤'—è–∑–∞–Ω—ñ –∑–º—ñ–Ω–Ω—ñ —Ç—É—Ç, —â–æ–± –≤–æ–Ω–∏ –±—É–ª–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ñ –≤ –º–µ–∂–∞—Ö —Å–∫—Ä–∏–ø—Ç–∞
    const musicPlayer = new Audio();
    let currentPlayingButton = null;
    let currentSongSrc = null;

    const avatars = {
     "Baby üòé": "üòé",
     "Pink Cloud ‚òÅÔ∏è": "‚òÅÔ∏è"
    };
    
    const userColors = {
     "Baby üòé": "message-baby",
     "Pink Cloud ‚òÅÔ∏è": "message-cloud"
    };

    function checkPassword() {
      const password = document.getElementById('passwordInput').value;
      const loginButton = document.getElementById('loginButton');
      if (password === "26060512") {
        document.getElementById('nicknameSelection').style.display = "block";
  passwordInput.style.display = "none"; // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –ø–æ–ª–µ –ø–∞—Ä–æ–ª—è
  loginButton.style.display = "none";   // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –∫–Ω–æ–ø–∫—É "–£–≤—ñ–π—Ç–∏"
  document.getElementById('loginError').textContent = "";
      } else {
        document.getElementById('loginError').textContent = "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø–∞—Ä–æ–ª—å.";
      }
    }

    function chooseNickname(nick) {
      selectedNickname = nick;
      document.getElementById('loginScreen').style.display = "none";
      document.getElementById('chatContainer').style.display = "flex";
      startChat();
    }

    function startChat() {
      socket = io("https://cloud-baby.onrender.com", {
        transports: ["websocket"]
      });

      socket.emit("register", selectedNickname); // –ø–µ—Ä–µ–¥–∞—î–º–æ –Ω—ñ–∫

      socket.on("chat_history", (messages) => {
      messages.forEach((data) => {
      const div = document.createElement("div");
      div.textContent = `${avatars[data.user] || "üë§"} ${data.user}: ${data.text}`;
      div.classList.add("message");

      const colorClass = userColors[data.user];
      if (colorClass) div.classList.add(colorClass);

      chat.appendChild(div);
    });
    scrollToBottom();
  });


      socket.on("message", (data) => {
  const div = document.createElement("div");
  div.textContent = `${avatars[data.user] || "üë§"} ${data.user}: ${data.text}`;
  div.classList.add("message");

  // –î–æ–¥–∞–π –∫–æ–ª—å–æ—Ä–æ–≤–∏–π –∫–ª–∞—Å
  const colorClass = userColors[data.user];
  if (colorClass) div.classList.add(colorClass);

  chat.appendChild(div);
  scrollToBottom();
});

      socket.on("users_online", (users) => {
        document.getElementById('users-online').textContent = "üü¢ –û–Ω–ª–∞–π–Ω: " + users.join(", ");
      });

      socket.on("typing", (data) => {
        const typingDiv = document.getElementById("typing-indicator");
        if (data.typing) {
          typingDiv.textContent = `${data.user} —à–æ—Å—å —Ç–∞–º —Ü—ñ–∫–∞–≤–µ–Ω—å–∫–µ –ø–∏—à–µ...–ª—é–±–ª—è—á–∏ —Ç–µ–±–µ –¥—É–∂–µ —Å–∏–ª—å–Ω–æ!`;
        } else {
          typingDiv.textContent = "";
        }
      });

      socket.emit("get_history");

      const msgInput = document.getElementById("msgInput");
      let typingTimeout;

      msgInput.addEventListener("input", () => {
        socket.emit("typing", true);
        clearTimeout(typingTimeout);
        typingTimeout = setTimeout(() => {
          socket.emit("typing", false);
        }, 2000);
      });

      msgInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      });

      document.querySelector(".chat-button").addEventListener("click", sendMessage);
    }

    function sendMessage() {
      const msgInput = document.getElementById("msgInput");
      const msg = msgInput.value.trim();
      if (msg && socket) {
        socket.emit("message", msg);
        msgInput.value = "";
      }
    }

    function scrollToBottom() {
      const chatBox = document.getElementById("chat");
      chatBox.scrollTop = chatBox.scrollHeight;
    }

        function playMusic(songSrc, buttonElement) {
      if (musicPlayer.src.includes(songSrc) && !musicPlayer.paused) {
        // –¢–∞ —Å–∞–º–∞ –ø—ñ—Å–Ω—è –≥—Ä–∞—î, —Å—Ç–∞–≤–∏–º–æ –Ω–∞ –ø–∞—É–∑—É
        musicPlayer.pause();
        buttonElement.classList.remove('playing');
        currentPlayingButton = null;
      } else if (musicPlayer.src.includes(songSrc) && musicPlayer.paused) {
        // –¢–∞ —Å–∞–º–∞ –ø—ñ—Å–Ω—è –Ω–∞ –ø–∞—É–∑—ñ, –ø—Ä–æ–¥–æ–≤–∂—É—î–º–æ –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è
        musicPlayer.play()
          .then(() => {
            if (currentPlayingButton && currentPlayingButton !== buttonElement) {
              currentPlayingButton.classList.remove('playing');
            }
            buttonElement.classList.add('playing');
            currentPlayingButton = buttonElement;
          })
          .catch(error => console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è –∞—É–¥—ñ–æ:", error));
      } else {
        // –ù–æ–≤–∞ –ø—ñ—Å–Ω—è –∞–±–æ —ñ–Ω—à–∞ –≤–∏–±—Ä–∞–Ω–∞
        if (currentPlayingButton) {
          currentPlayingButton.classList.remove('playing');
        }
        
        musicPlayer.src = songSrc;
        currentSongSrc = songSrc;
        musicPlayer.play()
          .then(() => {
            buttonElement.classList.add('playing');
            currentPlayingButton = buttonElement;
          })
          .catch(error => {
            console.error("–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∞—É–¥—ñ–æ:", error);
            currentSongSrc = null;
          });
      }
    }

    musicPlayer.onended = function() {
      if (currentPlayingButton) {
        currentPlayingButton.classList.remove('playing');
        currentPlayingButton = null;
      }
      currentSongSrc = null;
    };

    // --- –ö–µ—Ä—É–≤–∞–Ω–Ω—è –≥—É—á–Ω—ñ—Å—Ç—é ---
    const volumeToggleButton = document.getElementById('volumeToggleButton');
    const volumeSlider = document.getElementById('volumeSlider');

    function updateVolumeIcon(volume) {
      if (volume === 0) {
        volumeToggleButton.textContent = 'üîá';
      } else if (volume <= 0.33) {
        volumeToggleButton.textContent = 'üîà';
      } else if (volume <= 0.66) {
        volumeToggleButton.textContent = 'üîâ';
      } else {
        volumeToggleButton.textContent = 'üîä';
      }
    }

    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≥—É—á–Ω–æ—Å—Ç—ñ
    let initialVolume = parseFloat(localStorage.getItem('playerVolume'));
    if (isNaN(initialVolume) || initialVolume < 0 || initialVolume > 1) {
      initialVolume = 0.5; // –ì—É—á–Ω—ñ—Å—Ç—å –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
    }
    musicPlayer.volume = initialVolume;
    volumeSlider.value = initialVolume;
    updateVolumeIcon(initialVolume);

    volumeToggleButton.addEventListener('click', () => {
      if (volumeSlider.style.display === 'none') {
        volumeSlider.style.display = 'inline-block'; // –ê–±–æ 'block' —á–∏ 'flex' –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –±–∞–∂–∞–Ω–æ–≥–æ –≤–∏–≥–ª—è–¥—É
      } else {
        volumeSlider.style.display = 'none';
      }
    });

    volumeSlider.addEventListener('input', function() {
      musicPlayer.volume = this.value;
      updateVolumeIcon(parseFloat(this.value));
      localStorage.setItem('playerVolume', this.value);
    });

    // –ó–∞–∫—Ä–∏–≤–∞—Ç–∏ —Å–ª–∞–π–¥–µ—Ä –≥—É—á–Ω–æ—Å—Ç—ñ, —è–∫—â–æ –∫–ª—ñ–∫–Ω—É—Ç–∏ –¥–µ—ñ–Ω–¥–µ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
    // document.addEventListener('click', function(event) {
    //   if (!volumeControl.contains(event.target) && volumeSlider.style.display !== 'none') {
    //     volumeSlider.style.display = 'none';
    //   }
    // });
  </script>

</body>
</html>
